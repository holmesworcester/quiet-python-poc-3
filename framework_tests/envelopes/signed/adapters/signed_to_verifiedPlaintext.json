{
  "tests": [
    {
      "description": "Valid signature is verified and envelope becomes verifiedPlaintext",
      "direction": "apply",
      "given": {
        "envelope": "signed",
        "data": {"type": "message", "content": "Verified message"},
        "metadata": {
          "sender": "alice",
          "signature": "dummy_sig_alice"
        }
      },
      "then": {
        "envelope": "verifiedPlaintext",
        "data": {"type": "message", "content": "Verified message"},
        "metadata": {
          "sender": "alice",
          "verified": true
        }
      }
    },
    {
      "description": "Invalid signature fails verification",
      "direction": "apply",
      "given": {
        "envelope": "signed",
        "data": {"type": "message", "content": "Tampered message"},
        "metadata": {
          "sender": "mallory",
          "signature": "invalid_signature"
        },
        "db": {
          "state": {
            "crypto_mode": "real"
          }
        }
      },
      "then": {
        "envelope": "signed",
        "data": {"type": "message", "content": "Tampered message"},
        "metadata": {
          "sender": "mallory",
          "signature": "invalid_signature"
        }
      }
    },
    {
      "description": "Signature verification checks data integrity",
      "direction": "apply",
      "given": {
        "envelope": "signed",
        "data": {
          "type": "test",
          "value": 42,
          "nested": {"key": "value"}
        },
        "metadata": {
          "sender": "bob",
          "signature": "dummy_sig_bob_complex"
        }
      },
      "then": {
        "envelope": "verifiedPlaintext",
        "data": {
          "type": "test",
          "value": 42,
          "nested": {"key": "value"}
        },
        "metadata": {
          "sender": "bob",
          "verified": true
        }
      }
    }
  ]
}