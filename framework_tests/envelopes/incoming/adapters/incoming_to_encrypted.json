{
  "tests": [
    {
      "description": "Incoming envelope is recognized as encrypted",
      "direction": "apply",
      "given": {
        "envelope": "incoming",
        "data": "encrypted_incoming_data",
        "metadata": {
          "encrypted": true,
          "algorithm": "AES-256-GCM",
          "nonce": "incoming_nonce",
          "timestamp": "2024-01-01T00:00:00Z"
        }
      },
      "then": {
        "envelope": "encrypted",
        "data": "encrypted_incoming_data",
        "metadata": {
          "encrypted": true,
          "algorithm": "AES-256-GCM",
          "nonce": "incoming_nonce"
        }
      }
    },
    {
      "description": "Non-encrypted incoming envelope passes through unchanged",
      "direction": "apply",
      "given": {
        "envelope": "incoming",
        "data": {"type": "plain", "content": "not encrypted"},
        "metadata": {
          "timestamp": "2024-01-01T00:00:00Z"
        }
      },
      "then": {
        "envelope": "incoming",
        "data": {"type": "plain", "content": "not encrypted"},
        "metadata": {
          "timestamp": "2024-01-01T00:00:00Z"
        }
      }
    }
  ]
}