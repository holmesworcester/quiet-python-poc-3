{
  "tests": [
    {
      "description": "Encrypted envelope is decrypted to reveal signed content",
      "direction": "apply",
      "given": {
        "envelope": "encrypted",
        "data": "encrypted_blob",
        "metadata": {
          "encrypted": true,
          "algorithm": "AES-256-GCM",
          "nonce": "decrypt_nonce"
        }
      },
      "then": {
        "envelope": "signed",
        "data": "*",
        "metadata": {
          "sender": "*",
          "signature": "*"
        }
      }
    },
    {
      "description": "Decryption preserves original signed data structure",
      "direction": "apply",
      "given": {
        "envelope": "encrypted",
        "data": "complex_encrypted_data",
        "metadata": {
          "encrypted": true,
          "algorithm": "ChaCha20-Poly1305",
          "nonce": "test_nonce_789"
        },
        "db": {
          "state": {
            "crypto_mode": "real",
            "expected_decrypted": {
              "type": "message",
              "content": "Secret content",
              "timestamp": "2024-01-01T00:00:00Z"
            }
          }
        }
      },
      "then": {
        "envelope": "signed",
        "data": {
          "type": "message",
          "content": "*",
          "timestamp": "*"
        },
        "metadata": {
          "sender": "*",
          "signature": "*"
        }
      }
    }
  ]
}