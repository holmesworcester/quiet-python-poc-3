{
  "type": "peer",
  "projector": {
    "description": "Validates peer has public key and adds to projection",
    "func": "projector.project",
    "tests": [
      {
        "given": {
          "db": {"state": {}},
          "envelope": {
            "data": {
              "type": "peer",
              "pubkey": "peer123",
              "name": "Alice"
            },
            "metadata": {}
          }
        },
        "then": {
          "db": {
            "state": {
              "peers": [
                {
                  "pubkey": "peer123",
                  "name": "Alice",
                  "joined_via": "direct",
                  "added_at": "*"
                }
              ]
            },
            "eventStore": {
              "peer123": [
                {
                  "type": "peer",
                  "pubkey": "peer123",
                  "name": "Alice"
                }
              ]
            }
          }
        }
      },
      {
        "given": {
          "db": {"state": {}},
          "envelope": {
            "data": {
              "type": "peer",
              "pubkey": ""
            },
            "metadata": {}
          }
        },
        "then": {
          "db": {
            "state": {}
          }
        }
      }
    ]
  },
  "commands": {
    "create": {
      "description": "Creates a new peer event",
      "func": "create.execute",
      "tests": [
        {
          "given": {
            "db": {},
            "params": {"pubkey": "peer456", "name": "Bob"}
          },
          "then": {
            "return": {
              "return": "Peer created",
              "newEvents": [
                {"type": "peer", "pubkey": "peer456", "name": "Bob"}
              ],
              "peer": {"pubkey": "peer456", "name": "Bob"}
            }
          }
        }
      ]
    }
  }
}